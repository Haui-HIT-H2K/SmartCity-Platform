"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[3017],{1764:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"architecture","title":"3. Ki\u1ebfn Tr\xfac H\u1ec7 Th\u1ed1ng (System Architecture)","description":"3.1 T\u1ed5ng quan Ki\u1ebfn tr\xfac (Architecture Overview)","source":"@site/overview-docs/architecture.md","sourceDirName":".","slug":"/architecture","permalink":"/SmartCity-Platform/overview/architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"3. Ki\u1ebfn Tr\xfac H\u1ec7 Th\u1ed1ng (System Architecture)"},"sidebar":"overviewSidebar","previous":{"title":"2. M\xf4 T\u1ea3 H\u1ec7 Th\u1ed1ng (Overall Description)","permalink":"/SmartCity-Platform/overview/system-description"},"next":{"title":"4. Y\xeau C\u1ea7u Ch\u1ee9c N\u0103ng (Functional Requirements)","permalink":"/SmartCity-Platform/overview/functional-requirements"}}');var s=r(4848),t=r(8453);const l={sidebar_position:3,title:"3. Ki\u1ebfn Tr\xfac H\u1ec7 Th\u1ed1ng (System Architecture)"},c="3. Ki\u1ebfn tr\xfac H\u1ec7 th\u1ed1ng (System Architecture)",d={},o=[{value:"3.1 T\u1ed5ng quan Ki\u1ebfn tr\xfac (Architecture Overview)",id:"31-t\u1ed5ng-quan-ki\u1ebfn-tr\xfac-architecture-overview",level:2},{value:"S\u01a1 \u0111\u1ed3 Ki\u1ebfn tr\xfac T\u1ed5ng th\u1ec3",id:"s\u01a1-\u0111\u1ed3-ki\u1ebfn-tr\xfac-t\u1ed5ng-th\u1ec3",level:3},{value:"3.2 Component Architecture (Ki\u1ebfn tr\xfac Component)",id:"32-component-architecture-ki\u1ebfn-tr\xfac-component",level:2},{value:"3.2.1 Data Simulator",id:"321-data-simulator",level:3},{value:"3.2.2 Edge Storage (RabbitMQ)",id:"322-edge-storage-rabbitmq",level:3},{value:"3.2.3 Backend Service (Spring Boot)",id:"323-backend-service-spring-boot",level:3},{value:"3.2.4 ML Service (FastAPI)",id:"324-ml-service-fastapi",level:3},{value:"3.2.5 Storage Layer",id:"325-storage-layer",level:3},{value:"3.2.6 Frontend (NuxtJS)",id:"326-frontend-nuxtjs",level:3},{value:"3.3 Data Flow Architecture (Ki\u1ebfn tr\xfac Lu\u1ed3ng D\u1eef li\u1ec7u)",id:"33-data-flow-architecture-ki\u1ebfn-tr\xfac-lu\u1ed3ng-d\u1eef-li\u1ec7u",level:2},{value:"3.3.1 End-to-End Data Flow",id:"331-end-to-end-data-flow",level:3},{value:"3.3.2 Message Format",id:"332-message-format",level:3},{value:"3.4 Deployment Architecture (Ki\u1ebfn tr\xfac Tri\u1ec3n khai)",id:"34-deployment-architecture-ki\u1ebfn-tr\xfac-tri\u1ec3n-khai",level:2},{value:"3.4.1 Docker Compose Topology",id:"341-docker-compose-topology",level:3},{value:"3.4.2 Container Dependencies",id:"342-container-dependencies",level:3},{value:"3.4.3 Volume Mounts",id:"343-volume-mounts",level:3},{value:"3.5 Security Architecture (Ki\u1ebfn tr\xfac B\u1ea3o m\u1eadt)",id:"35-security-architecture-ki\u1ebfn-tr\xfac-b\u1ea3o-m\u1eadt",level:2},{value:"3.5.1 Network Security",id:"351-network-security",level:3},{value:"3.5.2 Data Security",id:"352-data-security",level:3},{value:"3.5.3 Future Security Enhancements",id:"353-future-security-enhancements",level:3},{value:"3.6 Scalability Architecture (Ki\u1ebfn tr\xfac Kh\u1ea3 n\u0103ng M\u1edf r\u1ed9ng)",id:"36-scalability-architecture-ki\u1ebfn-tr\xfac-kh\u1ea3-n\u0103ng-m\u1edf-r\u1ed9ng",level:2},{value:"3.6.1 Horizontal Scaling Points",id:"361-horizontal-scaling-points",level:3},{value:"3.6.2 Vertical Scaling Points",id:"362-vertical-scaling-points",level:3},{value:"3.7 Performance Architecture (T\u1ed1i \u01b0u Hi\u1ec7u n\u0103ng)",id:"37-performance-architecture-t\u1ed1i-\u01b0u-hi\u1ec7u-n\u0103ng",level:2},{value:"Optimization Strategies",id:"optimization-strategies",level:3},{value:"3.8 Monitoring Architecture (Ki\u1ebfn tr\xfac Gi\xe1m s\xe1t)",id:"38-monitoring-architecture-ki\u1ebfn-tr\xfac-gi\xe1m-s\xe1t",level:2},{value:"Current Monitoring",id:"current-monitoring",level:3},{value:"Future Monitoring (Potential)",id:"future-monitoring-potential",level:3}];function a(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"3-ki\u1ebfn-tr\xfac-h\u1ec7-th\u1ed1ng-system-architecture",children:"3. Ki\u1ebfn tr\xfac H\u1ec7 th\u1ed1ng (System Architecture)"})}),"\n",(0,s.jsx)(e.h2,{id:"31-t\u1ed5ng-quan-ki\u1ebfn-tr\xfac-architecture-overview",children:"3.1 T\u1ed5ng quan Ki\u1ebfn tr\xfac (Architecture Overview)"}),"\n",(0,s.jsxs)(e.p,{children:["SmartCity-Platform \xe1p d\u1ee5ng ",(0,s.jsx)(e.strong,{children:"ki\u1ebfn tr\xfac microservices"})," v\u1edbi ",(0,s.jsx)(e.strong,{children:"pull-based data ingestion"})," v\xe0 ",(0,s.jsx)(e.strong,{children:"tiered storage strategy"}),"."]}),"\n",(0,s.jsx)(e.h3,{id:"s\u01a1-\u0111\u1ed3-ki\u1ebfn-tr\xfac-t\u1ed5ng-th\u1ec3",children:"S\u01a1 \u0111\u1ed3 Ki\u1ebfn tr\xfac T\u1ed5ng th\u1ec3"}),"\n",(0,s.jsx)(e.mermaid,{value:'graph TB\r\n    subgraph "Data Generation Layer"\r\n        A[Python Data Simulator<br/>Faker + Random]\r\n    end\r\n    \r\n    subgraph "Edge Storage Layer"\r\n        B1[RabbitMQ Edge 1<br/>Port 5672]\r\n        B2[RabbitMQ Edge 2<br/>Port 5673]\r\n    end\r\n    \r\n    subgraph "Processing Layer"\r\n        C[Spring Boot Backend<br/>Java 17 + Maven]\r\n        D[ML Service<br/>FastAPI + IsolationForest]\r\n    end\r\n    \r\n    subgraph "Storage Layer"\r\n        E[Redis HOT<br/>In-memory + TTL 1h]\r\n        F1[MongoDB WARM<br/>30 days retention]\r\n        F2[MongoDB COLD<br/>Archive storage]\r\n    end\r\n    \r\n    subgraph "Presentation Layer"\r\n        G[NuxtJS Frontend<br/>TypeScript + TailwindCSS]\r\n    end\r\n    \r\n    A --\x3e|Publish 40M msgs| B1 & B2\r\n    B1 & B2 --\x3e|Pull Batch<br/>5000/10s| C\r\n    C <--\x3e|REST API<br/>/predict| D\r\n    C --\x3e|Store HOT| E\r\n    C --\x3e|Store WARM/COLD| F1 & F2\r\n    E --\x3e|Query| G\r\n    F1 & F2 --\x3e|Query| G\r\n    \r\n    style A fill:#FFE4B5\r\n    style B1 fill:#87CEEB\r\n    style B2 fill:#87CEEB\r\n    style C fill:#90EE90\r\n    style D fill:#FFB6C1\r\n    style E fill:#FF6B6B\r\n    style F1 fill:#4169E1\r\n    style F2 fill:#4169E1\r\n    style G fill:#FFD700'}),"\n",(0,s.jsx)(e.h2,{id:"32-component-architecture-ki\u1ebfn-tr\xfac-component",children:"3.2 Component Architecture (Ki\u1ebfn tr\xfac Component)"}),"\n",(0,s.jsx)(e.h3,{id:"321-data-simulator",children:"3.2.1 Data Simulator"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"C\xf4ng ngh\u1ec7:"})," Python 3.10, Faker, pika (RabbitMQ client)"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Tr\xe1ch nhi\u1ec7m:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Generate 40 tri\u1ec7u fake IoT messages"}),"\n",(0,s.jsxs)(e.li,{children:["Publish messages v\xe0o RabbitMQ queue ",(0,s.jsx)(e.code,{children:"smartcity.data"})]}),"\n",(0,s.jsx)(e.li,{children:"Simulate 1000 sensors v\u1edbi metric: temperature, humidity, CO2"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"\u0110\u1eb7c \u0111i\u1ec3m:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Multi-threaded: 20 concurrent threads"}),"\n",(0,s.jsx)(e.li,{children:"Rate: ~500 messages/second"}),"\n",(0,s.jsx)(e.li,{children:"Format: JSON v\u1edbi timestamp, sensorId, metricType, value"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"322-edge-storage-rabbitmq",children:"3.2.2 Edge Storage (RabbitMQ)"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"C\xf4ng ngh\u1ec7:"})," RabbitMQ 3.x"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Tr\xe1ch nhi\u1ec7m:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Buffer d\u1eef li\u1ec7u t\u1eeb sensors"}),"\n",(0,s.jsx)(e.li,{children:"Cung c\u1ea5p queue cho backend pull"}),"\n",(0,s.jsx)(e.li,{children:"\u0110\u1ea3m b\u1ea3o high availability v\u1edbi 2 nodes"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Topology:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Exchange"}),": ",(0,s.jsx)(e.code,{children:"smartcity.exchange"})," (type: direct)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Queue"}),": ",(0,s.jsx)(e.code,{children:"smartcity.data"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Routing Key"}),": ",(0,s.jsx)(e.code,{children:"sensor.data"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Configuration:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Durable queue: true (persist to disk)"}),"\n",(0,s.jsx)(e.li,{children:"Message TTL: None (gi\u1eef cho \u0111\u1ebfn khi consumed)"}),"\n",(0,s.jsx)(e.li,{children:"Prefetch count: 5000 (batch size)"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"323-backend-service-spring-boot",children:"3.2.3 Backend Service (Spring Boot)"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"C\xf4ng ngh\u1ec7:"})," Spring Boot 3.2, Java 17, Maven"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Modules:"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"a) Data Ingestion Module"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"RabbitMQIngestionService"}),": Pull messages t\u1eeb RabbitMQ"]}),"\n",(0,s.jsx)(e.li,{children:"Scheduled task: Fixed rate 10 seconds"}),"\n",(0,s.jsx)(e.li,{children:"Batch processing: 1000-5000 messages per batch"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"b) ML Integration Module"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"MLServiceClient"}),": REST client cho ML Service"]}),"\n",(0,s.jsxs)(e.li,{children:["Endpoint: ",(0,s.jsx)(e.code,{children:"POST http://ml-service:8000/predict"})]}),"\n",(0,s.jsx)(e.li,{children:"Retry logic: 3 attempts v\u1edbi exponential backoff"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"c) Data Routing Module"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"DataRoutingService"}),": Route data theo classification"]}),"\n",(0,s.jsx)(e.li,{children:"Logic: HOT \u2192 Redis, WARM/COLD \u2192 MongoDB"}),"\n",(0,s.jsx)(e.li,{children:"Bulk operations cho MongoDB insert"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"d) API Module"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"DataController"}),": Endpoints cho data query"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"SystemController"}),": Endpoints cho system management"]}),"\n",(0,s.jsx)(e.li,{children:"CORS enabled cho frontend"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Ports:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"8080: REST API"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"324-ml-service-fastapi",children:"3.2.4 ML Service (FastAPI)"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"C\xf4ng ngh\u1ec7:"})," FastAPI, scikit-learn, uvicorn"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Models:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"temperature_model.pkl"}),": IsolationForest cho temperature anomaly"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"humidity_model.pkl"}),": IsolationForest cho humidity anomaly"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"co2_model.pkl"}),": IsolationForest cho CO2 anomaly"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"API Endpoints:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"POST /predict"}),": Classify single message"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"GET /health"}),": Health check"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"GET /models"}),": List loaded models"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Classification Logic:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"# IsolationForest returns:\r\n# -1: Anomaly (outlier) \u2192 Label as HOT\r\n# 1: Normal (inlier) \u2192 Label as COLD\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Performance:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Latency: < 50ms per prediction"}),"\n",(0,s.jsx)(e.li,{children:"Throughput: ~20 requests/second per model"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"325-storage-layer",children:"3.2.5 Storage Layer"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"a) Redis (HOT Tier)"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"C\xf4ng ngh\u1ec7:"})," Redis Alpine"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Data Structure:"})," Hash v\u1edbi key pattern ",(0,s.jsx)(e.code,{children:"hot:sensor:{sensorId}:{timestamp}"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"TTL:"})," 3600 seconds (1 gi\u1edd)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Use Case:"})," Real-time dashboard queries"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"b) MongoDB WARM"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Database:"})," ",(0,s.jsx)(e.code,{children:"warm_db"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Collection:"})," ",(0,s.jsx)(e.code,{children:"city_data"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Indexes:"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"timestamp"})," (TTL index, 30 days)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"sensorId"})," (for query optimization)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"metricType"})," (for filtering)"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Use Case:"})," Recent data analysis, trending"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"c) MongoDB COLD"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Database:"})," ",(0,s.jsx)(e.code,{children:"cold_db"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Collection:"})," ",(0,s.jsx)(e.code,{children:"city_data"})]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Indexes:"})," Same as WARM"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Retention:"})," V\u0129nh vi\u1ec5n (no TTL)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Use Case:"})," Historical analysis, long-term storage"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"326-frontend-nuxtjs",children:"3.2.6 Frontend (NuxtJS)"}),"\n",(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.strong,{children:"C\xf4ng ngh\u1ec7:"})," Nuxt 3, TypeScript, TailwindCSS, Pinia, ECharts"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Pages:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"/"}),": Dashboard v\u1edbi real-time charts"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"/data-explorer"}),": Data table v\u1edbi pagination"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"/system-control"}),": Manual sync v\xe0 reset"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Components:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"RealtimeLineChart"}),": ECharts line chart"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"StatCard"}),": Storage statistics display"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"NodeCard"}),": Edge node status display"]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"State Management:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"systemStore"}),": System stats, edge nodes"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"dataStore"}),": City data, filters, pagination"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"33-data-flow-architecture-ki\u1ebfn-tr\xfac-lu\u1ed3ng-d\u1eef-li\u1ec7u",children:"3.3 Data Flow Architecture (Ki\u1ebfn tr\xfac Lu\u1ed3ng D\u1eef li\u1ec7u)"}),"\n",(0,s.jsx)(e.h3,{id:"331-end-to-end-data-flow",children:"3.3.1 End-to-End Data Flow"}),"\n",(0,s.jsx)(e.mermaid,{value:"sequenceDiagram\r\n    participant Sim as Data Simulator\r\n    participant RMQ as RabbitMQ\r\n    participant BE as Backend\r\n    participant ML as ML Service\r\n    participant Redis as Redis HOT\r\n    participant Mongo as MongoDB\r\n    participant FE as Frontend\r\n    \r\n    Sim->>RMQ: 1. Publish message\r\n    Note over RMQ: Queue: smartcity.data\r\n    \r\n    loop Every 10 seconds\r\n        BE->>RMQ: 2. Pull batch (5000 msgs)\r\n        RMQ--\x3e>BE: Messages\r\n        \r\n        loop For each message\r\n            BE->>ML: 3. POST /predict\r\n            ML--\x3e>BE: Label: HOT/WARM/COLD\r\n        end\r\n        \r\n        alt Label = HOT\r\n            BE->>Redis: 4a. Store with TTL 1h\r\n        else Label = WARM/COLD\r\n            BE->>Mongo: 4b. Bulk insert\r\n        end\r\n    end\r\n    \r\n    loop Every 2 seconds\r\n        FE->>BE: 5. GET /api/stats\r\n        BE->>Redis: Query HOT count\r\n        BE->>Mongo: Query WARM/COLD count\r\n        BE--\x3e>FE: Statistics\r\n    end"}),"\n",(0,s.jsx)(e.h3,{id:"332-message-format",children:"3.3.2 Message Format"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Input Message (from Simulator):"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\r\n  "timestamp": "2025-12-04T22:57:00Z",\r\n  "sensorId": "SENSOR_0042",\r\n  "metricType": "temperature",\r\n  "value": 45.5,\r\n  "location": {\r\n    "lat": 21.0285,\r\n    "lng": 105.8542\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"ML Prediction Request:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\r\n  "source": "SENSOR_0042",\r\n  "metric_type": "temperature",\r\n  "value": 45.5\r\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"ML Prediction Response:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\r\n  "label": "HOT",\r\n  "uri": "https://schema.org/Warning",\r\n  "desc": "Temperature Anomaly Detected"\r\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Stored Entity (CityData):"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",children:'{\r\n  "_id": "ObjectId(...)",\r\n  "timestamp": "2025-12-04T22:57:00Z",\r\n  "sensorId": "SENSOR_0042",\r\n  "metricType": "temperature",\r\n  "value": 45.5,\r\n  "dataType": "HOT",\r\n  "location": {\r\n    "lat": 21.0285,\r\n    "lng": 105.8542\r\n  },\r\n  "createdAt": "2025-12-04T22:57:01Z"\r\n}\n'})}),"\n",(0,s.jsx)(e.h2,{id:"34-deployment-architecture-ki\u1ebfn-tr\xfac-tri\u1ec3n-khai",children:"3.4 Deployment Architecture (Ki\u1ebfn tr\xfac Tri\u1ec3n khai)"}),"\n",(0,s.jsx)(e.h3,{id:"341-docker-compose-topology",children:"3.4.1 Docker Compose Topology"}),"\n",(0,s.jsx)(e.mermaid,{value:'graph LR\r\n    subgraph "Docker Network: smartcity-network"\r\n        subgraph "Edge Storage"\r\n            A[rabbitmq-edge-1<br/>Container]\r\n            B[rabbitmq-edge-2<br/>Container]\r\n        end\r\n        \r\n        subgraph "Storage"\r\n            C[core-redis-hot<br/>Container]\r\n            D[core-mongo-warm<br/>Container]\r\n            E[core-mongo-cold<br/>Container]\r\n        end\r\n        \r\n        subgraph "Processing"\r\n            F[smart-city-backend<br/>Container]\r\n            G[smart-city-ml<br/>Container]\r\n        end\r\n        \r\n        subgraph "Presentation"\r\n            H[smart-city-frontend<br/>Container]\r\n        end\r\n    end\r\n    \r\n    F --\x3e A & B & C & D & E & G\r\n    H --\x3e F\r\n    \r\n    style A fill:#87CEEB\r\n    style B fill:#87CEEB\r\n    style F fill:#90EE90\r\n    style G fill:#FFB6C1\r\n    style H fill:#FFD700'}),"\n",(0,s.jsx)(e.h3,{id:"342-container-dependencies",children:"3.4.2 Container Dependencies"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Dependency Graph:"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{children:"smart-city-frontend\r\n  \u2514\u2500 depends_on: smart-city-backend\r\n\r\nsmart-city-backend\r\n  \u251c\u2500 depends_on: rabbitmq-edge-1\r\n  \u251c\u2500 depends_on: rabbitmq-edge-2\r\n  \u251c\u2500 depends_on: core-redis-hot\r\n  \u251c\u2500 depends_on: core-mongo-warm\r\n  \u251c\u2500 depends_on: core-mongo-cold\r\n  \u2514\u2500 depends_on: smart-city-ml\r\n\r\nsmart-city-ml\r\n  \u2514\u2500 (no dependencies)\n"})}),"\n",(0,s.jsx)(e.h3,{id:"343-volume-mounts",children:"3.4.3 Volume Mounts"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-yaml",children:"Volumes:\r\n  - rabbitmq_edge1_data \u2192 /var/lib/rabbitmq\r\n  - rabbitmq_edge2_data \u2192 /var/lib/rabbitmq\r\n  - redis_hot_data \u2192 /data\r\n  - mongo_warm_data \u2192 /data/db\r\n  - mongo_cold_data \u2192 /data/db\n"})}),"\n",(0,s.jsx)(e.h2,{id:"35-security-architecture-ki\u1ebfn-tr\xfac-b\u1ea3o-m\u1eadt",children:"3.5 Security Architecture (Ki\u1ebfn tr\xfac B\u1ea3o m\u1eadt)"}),"\n",(0,s.jsx)(e.h3,{id:"351-network-security",children:"3.5.1 Network Security"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Container Isolation"}),": T\u1ea5t c\u1ea3 services trong Docker network ri\xeang"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Port Exposure"}),": Ch\u1ec9 expose ports c\u1ea7n thi\u1ebft (3000, 8080, 8000, etc.)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"No External Auth"}),": Demo system, kh\xf4ng c\xf3 authentication (future enhancement)"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"352-data-security",children:"3.5.2 Data Security"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"No Encryption"}),": D\u1eef li\u1ec7u kh\xf4ng m\xe3 h\xf3a (demo purpose)"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"Input Validation"}),": Backend validate input data format"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.strong,{children:"SQL Injection Protection"}),": S\u1eed d\u1ee5ng MongoDB (NoSQL)"]}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"353-future-security-enhancements",children:"3.5.3 Future Security Enhancements"}),"\n",(0,s.jsxs)(e.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","JWT-based authentication cho API"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","HTTPS/TLS cho all communication"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","RabbitMQ user authentication"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","MongoDB role-based access control"]}),"\n",(0,s.jsxs)(e.li,{className:"task-list-item",children:[(0,s.jsx)(e.input,{type:"checkbox",disabled:!0})," ","Rate limiting cho API endpoints"]}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"36-scalability-architecture-ki\u1ebfn-tr\xfac-kh\u1ea3-n\u0103ng-m\u1edf-r\u1ed9ng",children:"3.6 Scalability Architecture (Ki\u1ebfn tr\xfac Kh\u1ea3 n\u0103ng M\u1edf r\u1ed9ng)"}),"\n",(0,s.jsx)(e.h3,{id:"361-horizontal-scaling-points",children:"3.6.1 Horizontal Scaling Points"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"RabbitMQ:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Th\xeam edge nodes: ",(0,s.jsx)(e.code,{children:"rabbitmq-edge-3"}),", ",(0,s.jsx)(e.code,{children:"rabbitmq-edge-4"})]}),"\n",(0,s.jsx)(e.li,{children:"Backend t\u1ef1 \u0111\u1ed9ng discover qua DNS"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Backend:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Run multiple instances v\u1edbi load balancer"}),"\n",(0,s.jsx)(e.li,{children:"M\u1ed7i instance pull t\u1eeb RabbitMQ \u0111\u1ed9c l\u1eadp"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"MongoDB:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Sharding cho WARM v\xe0 COLD collections"}),"\n",(0,s.jsx)(e.li,{children:"Replica sets cho high availability"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Frontend:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Nginx load balancer cho multiple frontend instances"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"362-vertical-scaling-points",children:"3.6.2 Vertical Scaling Points"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Backend:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Increase batch size: ",(0,s.jsx)(e.code,{children:"1000 \u2192 10000"})]}),"\n",(0,s.jsxs)(e.li,{children:["Increase thread pool: ",(0,s.jsx)(e.code,{children:"10 \u2192 50"})]}),"\n",(0,s.jsxs)(e.li,{children:["Increase JVM heap: ",(0,s.jsx)(e.code,{children:"-Xmx2g \u2192 -Xmx8g"})]}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"ML Service:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Multiple worker processes v\u1edbi Gunicorn"}),"\n",(0,s.jsx)(e.li,{children:"GPU acceleration cho predictions (future)"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Redis:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Increase max memory: ",(0,s.jsx)(e.code,{children:"256mb \u2192 2gb"})]}),"\n",(0,s.jsx)(e.li,{children:"Enable Redis Cluster mode"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"37-performance-architecture-t\u1ed1i-\u01b0u-hi\u1ec7u-n\u0103ng",children:"3.7 Performance Architecture (T\u1ed1i \u01b0u Hi\u1ec7u n\u0103ng)"}),"\n",(0,s.jsx)(e.h3,{id:"optimization-strategies",children:"Optimization Strategies"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"1. Batch Processing"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Pull 5000 messages t\u1eeb RabbitMQ m\u1ed7i l\u1ea7n"}),"\n",(0,s.jsx)(e.li,{children:"Bulk insert v\xe0o MongoDB (1000 docs per batch)"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"2. Parallel Processing"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Multi-threaded message processing"}),"\n",(0,s.jsx)(e.li,{children:"Concurrent ML predictions"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"3. Caching"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Redis cho HOT data (in-memory access)"}),"\n",(0,s.jsx)(e.li,{children:"Application-level cache cho system stats"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"4. Database Indexing"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"MongoDB indexes tr\xean timestamp, sensorId"}),"\n",(0,s.jsx)(e.li,{children:"Compound indexes cho complex queries"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"5. Connection Pooling"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"RabbitMQ connection pool"}),"\n",(0,s.jsx)(e.li,{children:"MongoDB connection pool"}),"\n",(0,s.jsx)(e.li,{children:"Redis connection pool"}),"\n"]}),"\n",(0,s.jsx)(e.h2,{id:"38-monitoring-architecture-ki\u1ebfn-tr\xfac-gi\xe1m-s\xe1t",children:"3.8 Monitoring Architecture (Ki\u1ebfn tr\xfac Gi\xe1m s\xe1t)"}),"\n",(0,s.jsx)(e.h3,{id:"current-monitoring",children:"Current Monitoring"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Backend Metrics:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Data ingestion rate (incoming vs processed)"}),"\n",(0,s.jsx)(e.li,{children:"Classification distribution (HOT/WARM/COLD counts)"}),"\n",(0,s.jsx)(e.li,{children:"Edge node health status"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Frontend Dashboard:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"Real-time charts (ECharts)"}),"\n",(0,s.jsx)(e.li,{children:"Auto-refresh every 2 seconds"}),"\n",(0,s.jsx)(e.li,{children:"Node status indicators"}),"\n"]}),"\n",(0,s.jsx)(e.h3,{id:"future-monitoring-potential",children:"Future Monitoring (Potential)"}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Prometheus + Grafana:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"JVM metrics (heap, CPU, threads)"}),"\n",(0,s.jsx)(e.li,{children:"MongoDB performance metrics"}),"\n",(0,s.jsx)(e.li,{children:"RabbitMQ queue depth"}),"\n",(0,s.jsx)(e.li,{children:"Custom business metrics"}),"\n"]}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.strong,{children:"Logging Stack:"})}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"ELK (Elasticsearch, Logstash, Kibana)"}),"\n",(0,s.jsx)(e.li,{children:"Centralized log aggregation"}),"\n",(0,s.jsx)(e.li,{children:"Log retention policies"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(a,{...n})}):a(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>l,x:()=>c});var i=r(6540);const s={},t=i.createContext(s);function l(n){const e=i.useContext(t);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:l(n.components),i.createElement(t.Provider,{value:e},n.children)}}}]);